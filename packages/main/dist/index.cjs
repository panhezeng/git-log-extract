"use strict";
const electron = require("electron");
const path = require("path");
const url = require("url");
const Store = require("electron-store");
const fs = require("fs-extra");
const simpleGit = require("simple-git");
const _interopDefaultLegacy = (e) => e && typeof e === "object" && "default" in e ? e : { default: e };
const path__default = /* @__PURE__ */ _interopDefaultLegacy(path);
const Store__default = /* @__PURE__ */ _interopDefaultLegacy(Store);
const fs__default = /* @__PURE__ */ _interopDefaultLegacy(fs);
const simpleGit__default = /* @__PURE__ */ _interopDefaultLegacy(simpleGit);
async function createWindow() {
  const browserWindow = new electron.BrowserWindow({
    show: false,
    webPreferences: {
      preload: path.join(electron.app.getAppPath(), "packages/preload/dist/index.cjs")
    }
  });
  browserWindow.on("ready-to-show", () => {
    browserWindow == null ? void 0 : browserWindow.show();
    {
      browserWindow == null ? void 0 : browserWindow.webContents.openDevTools();
    }
  });
  const pageUrl = "http://localhost:5173/";
  await browserWindow.loadURL(pageUrl);
  return browserWindow;
}
async function restoreOrCreateWindow() {
  let window = electron.BrowserWindow.getAllWindows().find((w) => !w.isDestroyed());
  if (window === void 0) {
    window = await createWindow();
  }
  if (window.isMinimized()) {
    window.restore();
  }
  window.focus();
}
const channel = {
  app: {
    getPath: "app.getPath"
  },
  dialog: "dialog",
  path: {
    resolve: "path.resolve",
    join: "path.join",
    sep: "path.sep"
  },
  fs: {
    existsSync: "fs.existsSync",
    removeSync: "fs.removeSync",
    emptyDirSync: "fs.emptyDirSync"
  },
  store: {
    get: "store.get",
    set: "store.set"
  },
  git: {
    repositoryAuthUrl: "git.repositoryAuthUrl",
    branchSummary: "git.branchSummary",
    logResult: "git.logResult"
  }
};
const appTitle = "Git Log Extract";
electron.ipcMain.handle(channel.dialog, async (event, options) => {
  return await electron.dialog.showOpenDialog(options);
});
electron.ipcMain.on(
  channel.app.getPath,
  async (event, ...args) => {
    event.returnValue = electron.app.getPath(...args);
  }
);
electron.ipcMain.on(
  channel.path.resolve,
  async (event, ...args) => {
    event.returnValue = path__default.default.resolve(...args);
  }
);
electron.ipcMain.on(channel.path.join, async (event, ...args) => {
  event.returnValue = path__default.default.join(...args);
});
electron.ipcMain.on(channel.path.sep, async (event) => {
  event.returnValue = path__default.default.sep;
});
electron.ipcMain.on(
  channel.fs.existsSync,
  async (event, ...args) => {
    event.returnValue = fs__default.default.existsSync(...args);
  }
);
electron.ipcMain.on(
  channel.fs.removeSync,
  async (event, ...args) => {
    event.returnValue = fs__default.default.removeSync(...args);
  }
);
electron.ipcMain.on(
  channel.fs.emptyDirSync,
  async (event, ...args) => {
    event.returnValue = fs__default.default.emptyDirSync(...args);
  }
);
const store = new Store__default.default({
  name: "git-log-extract-main-config",
  cwd: path__default.default.join(electron.app.getPath("appData"), appTitle)
});
electron.ipcMain.on(channel.store.set, async (event, ...args) => {
  store.set(...args);
});
electron.ipcMain.on(channel.store.get, async (event, key, defaultValue) => {
  event.returnValue = store.get(key, defaultValue);
});
electron.ipcMain.handle(
  channel.git.repositoryAuthUrl,
  async (event, url$1, username, password) => {
    const urlObj = new url.URL(url$1);
    urlObj.username = username;
    urlObj.password = password;
    return urlObj.href;
  }
);
function createGit(options, onProgress) {
  if (typeof options === "undefined") {
    options = { baseDir: "" };
  }
  const git = simpleGit__default.default(options);
  git.outputHandler((bin, stdout, stderr, args) => {
    stdout.pipe(process.stdout);
    stderr.pipe(process.stderr);
    stderr.on("data", function(stdData) {
      if (onProgress) {
        onProgress(stdData.toString());
      }
    });
  });
  return git;
}
electron.ipcMain.handle(
  channel.git.branchSummary,
  async (event, directoryPath, repositoryAuthUrl) => {
    const git = createGit({
      baseDir: directoryPath
    });
    await git.init();
    await git.addRemote("origin", repositoryAuthUrl);
    await git.fetch(['--shallow-since="1 months ago"']);
    const branchSummary = await git.branch(["-r"]);
    return branchSummary;
  }
);
electron.ipcMain.handle(
  channel.git.logResult,
  async (event, directoryPath, logOptions) => {
    const git = createGit({ baseDir: directoryPath });
    await git.fetch(['--shallow-since="1 months ago"']);
    const logResult = await git.log(logOptions);
    return logResult;
  }
);
const isSingleInstance = electron.app.requestSingleInstanceLock();
if (!isSingleInstance) {
  electron.app.quit();
  process.exit(0);
}
electron.app.on("second-instance", restoreOrCreateWindow);
electron.app.disableHardwareAcceleration();
electron.app.on("window-all-closed", () => {
  if (process.platform !== "darwin") {
    electron.app.quit();
  }
});
electron.app.on("activate", restoreOrCreateWindow);
electron.app.whenReady().then(restoreOrCreateWindow).catch((e) => console.error("Failed create window:", e));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguY2pzIiwic291cmNlcyI6WyIuLi9zcmMvbWFpbldpbmRvdy50cyIsIi4uLy4uL2NvbW1vbi9zcmMvY2hhbm5lbC50cyIsIi4uL3NyYy9pcGNNYWluTGlzdGVuZXIudHMiLCIuLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHthcHAsIEJyb3dzZXJXaW5kb3d9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7am9pbn0gZnJvbSAncGF0aCc7XG5pbXBvcnQge1VSTH0gZnJvbSAndXJsJztcblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlV2luZG93KCkge1xuICBjb25zdCBicm93c2VyV2luZG93ID0gbmV3IEJyb3dzZXJXaW5kb3coe1xuICAgIHNob3c6IGZhbHNlLCAvLyBVc2UgdGhlICdyZWFkeS10by1zaG93JyBldmVudCB0byBzaG93IHRoZSBpbnN0YW50aWF0ZWQgQnJvd3NlcldpbmRvdy5cbiAgICB3ZWJQcmVmZXJlbmNlczoge1xuICAgICAgcHJlbG9hZDogam9pbihhcHAuZ2V0QXBwUGF0aCgpLCAncGFja2FnZXMvcHJlbG9hZC9kaXN0L2luZGV4LmNqcycpLFxuICAgIH0sXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBJZiB0aGUgJ3Nob3cnIHByb3BlcnR5IG9mIHRoZSBCcm93c2VyV2luZG93J3MgY29uc3RydWN0b3IgaXMgb21pdHRlZCBmcm9tIHRoZSBpbml0aWFsaXphdGlvbiBvcHRpb25zLFxuICAgKiBpdCB0aGVuIGRlZmF1bHRzIHRvICd0cnVlJy4gVGhpcyBjYW4gY2F1c2UgZmxpY2tlcmluZyBhcyB0aGUgd2luZG93IGxvYWRzIHRoZSBodG1sIGNvbnRlbnQsXG4gICAqIGFuZCBpdCBhbHNvIGhhcyBzaG93IHByb2JsZW1hdGljIGJlaGF2aW91ciB3aXRoIHRoZSBjbG9zaW5nIG9mIHRoZSB3aW5kb3cuXG4gICAqIFVzZSBgc2hvdzogZmFsc2VgIGFuZCBsaXN0ZW4gdG8gdGhlICBgcmVhZHktdG8tc2hvd2AgZXZlbnQgdG8gc2hvdyB0aGUgd2luZG93LlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGVjdHJvbi9lbGVjdHJvbi9pc3N1ZXMvMjUwMTIgZm9yIHRoZSBhZmZvcmQgbWVudGlvbmVkIGlzc3VlLlxuICAgKi9cbiAgYnJvd3NlcldpbmRvdy5vbigncmVhZHktdG8tc2hvdycsICgpID0+IHtcbiAgICBicm93c2VyV2luZG93Py5zaG93KCk7XG5cbiAgICBpZiAoaW1wb3J0Lm1ldGEuZW52LkRFVikge1xuICAgICAgYnJvd3NlcldpbmRvdz8ud2ViQ29udGVudHMub3BlbkRldlRvb2xzKCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogVVJMIGZvciBtYWluIHdpbmRvdy5cbiAgICogVml0ZSBkZXYgc2VydmVyIGZvciBkZXZlbG9wbWVudC5cbiAgICogYGZpbGU6Ly8uLi9yZW5kZXJlci9pbmRleC5odG1sYCBmb3IgcHJvZHVjdGlvbiBhbmQgdGVzdC5cbiAgICovXG4gIGNvbnN0IHBhZ2VVcmwgPVxuICAgIGltcG9ydC5tZXRhLmVudi5ERVYgJiYgaW1wb3J0Lm1ldGEuZW52LlZJVEVfREVWX1NFUlZFUl9VUkwgIT09IHVuZGVmaW5lZFxuICAgICAgPyBpbXBvcnQubWV0YS5lbnYuVklURV9ERVZfU0VSVkVSX1VSTFxuICAgICAgOiBuZXcgVVJMKCcuLi9yZW5kZXJlci9kaXN0L2luZGV4Lmh0bWwnLCAnZmlsZTovLycgKyBfX2Rpcm5hbWUpLnRvU3RyaW5nKCk7XG5cbiAgYXdhaXQgYnJvd3NlcldpbmRvdy5sb2FkVVJMKHBhZ2VVcmwpO1xuXG4gIHJldHVybiBicm93c2VyV2luZG93O1xufVxuXG4vKipcbiAqIFJlc3RvcmUgYW4gZXhpc3RpbmcgQnJvd3NlcldpbmRvdyBvciBDcmVhdGUgYSBuZXcgQnJvd3NlcldpbmRvdy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVPckNyZWF0ZVdpbmRvdygpIHtcbiAgbGV0IHdpbmRvdyA9IEJyb3dzZXJXaW5kb3cuZ2V0QWxsV2luZG93cygpLmZpbmQodyA9PiAhdy5pc0Rlc3Ryb3llZCgpKTtcblxuICBpZiAod2luZG93ID09PSB1bmRlZmluZWQpIHtcbiAgICB3aW5kb3cgPSBhd2FpdCBjcmVhdGVXaW5kb3coKTtcbiAgfVxuXG4gIGlmICh3aW5kb3cuaXNNaW5pbWl6ZWQoKSkge1xuICAgIHdpbmRvdy5yZXN0b3JlKCk7XG4gIH1cblxuICB3aW5kb3cuZm9jdXMoKTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IHtcbiAgYXBwOiB7XG4gICAgZ2V0UGF0aDogJ2FwcC5nZXRQYXRoJyxcbiAgfSxcbiAgZGlhbG9nOiAnZGlhbG9nJyxcbiAgcGF0aDoge1xuICAgIHJlc29sdmU6ICdwYXRoLnJlc29sdmUnLFxuICAgIGpvaW46ICdwYXRoLmpvaW4nLFxuICAgIHNlcDogJ3BhdGguc2VwJyxcbiAgfSxcbiAgZnM6IHtcbiAgICBleGlzdHNTeW5jOiAnZnMuZXhpc3RzU3luYycsXG4gICAgcmVtb3ZlU3luYzogJ2ZzLnJlbW92ZVN5bmMnLFxuICAgIGVtcHR5RGlyU3luYzogJ2ZzLmVtcHR5RGlyU3luYycsXG4gIH0sXG4gIHN0b3JlOiB7XG4gICAgZ2V0OiAnc3RvcmUuZ2V0JyxcbiAgICBzZXQ6ICdzdG9yZS5zZXQnLFxuICB9LFxuICBnaXQ6IHtcbiAgICByZXBvc2l0b3J5QXV0aFVybDogJ2dpdC5yZXBvc2l0b3J5QXV0aFVybCcsXG4gICAgYnJhbmNoU3VtbWFyeTogJ2dpdC5icmFuY2hTdW1tYXJ5JyxcbiAgICBsb2dSZXN1bHQ6ICdnaXQubG9nUmVzdWx0JyxcbiAgfSxcbn07XG4iLCJpbXBvcnQgdHlwZSB7V2luZG93RWxlY3Ryb25QYXJhbWV0ZXJzfSBmcm9tICcqLnZ1ZXx0c3x0c3gnO1xuaW1wb3J0IGNoYW5uZWwgZnJvbSAnQC9jb21tb24vY2hhbm5lbCc7XG5pbXBvcnQge2FwcFRpdGxlfSBmcm9tICdAL2NvbW1vbi9pbmRleC5qc29uJztcbmltcG9ydCB0eXBlIHtPcGVuRGlhbG9nT3B0aW9uc30gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IHthcHAsIGRpYWxvZywgaXBjTWFpbn0gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IFN0b3JlIGZyb20gJ2VsZWN0cm9uLXN0b3JlJztcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB0eXBlIHtCcmFuY2hTdW1tYXJ5LCBMb2dSZXN1bHQsIFNpbXBsZUdpdE9wdGlvbnN9IGZyb20gJ3NpbXBsZS1naXQnO1xuaW1wb3J0IHNpbXBsZUdpdCBmcm9tICdzaW1wbGUtZ2l0JztcbmltcG9ydCB7VVJMfSBmcm9tICd1cmwnO1xuXG4vL1xuLy8gaXBjTWFpbi5oYW5kbGUoY2hhbm5lbC5leGFtcGxlLCBhc3luYyAoZXZlbnQsIC4uLmFyZ3MpID0+IHt9KTtcbi8vIGlwY01haW4ub24oY2hhbm5lbC5leGFtcGxlLCBhc3luYyAoZXZlbnQsIC4uLmFyZ3MpID0+IHtcbi8vICAgZXZlbnQucmV0dXJuVmFsdWUgPSAnJztcbi8vIH0pO1xuLy8gZ2V0V2luZG93KCkhLndlYkNvbnRlbnRzLnNlbmQoY2hhbm5lbC5leGFtcGxlLCBkYXRhKTtcblxuLy8gZWxlY3Ryb24gc3RhcnRcbmlwY01haW4uaGFuZGxlKGNoYW5uZWwuZGlhbG9nLCBhc3luYyAoZXZlbnQsIG9wdGlvbnM6IE9wZW5EaWFsb2dPcHRpb25zKSA9PiB7XG4gIHJldHVybiBhd2FpdCBkaWFsb2cuc2hvd09wZW5EaWFsb2cob3B0aW9ucyk7XG59KTtcblxuaXBjTWFpbi5vbihcbiAgY2hhbm5lbC5hcHAuZ2V0UGF0aCxcbiAgYXN5bmMgKGV2ZW50LCAuLi5hcmdzOiBXaW5kb3dFbGVjdHJvblBhcmFtZXRlcnNbJ2FwcCddWydnZXRQYXRoJ10pID0+IHtcbiAgICBldmVudC5yZXR1cm5WYWx1ZSA9IGFwcC5nZXRQYXRoKC4uLmFyZ3MpO1xuICB9LFxuKTtcbi8vIGVsZWN0cm9uIGVuZFxuXG4vLyBub2RlIHN0YXJ0XG5pcGNNYWluLm9uKFxuICBjaGFubmVsLnBhdGgucmVzb2x2ZSxcbiAgYXN5bmMgKGV2ZW50LCAuLi5hcmdzOiBXaW5kb3dFbGVjdHJvblBhcmFtZXRlcnNbJ3BhdGgnXVsncmVzb2x2ZSddKSA9PiB7XG4gICAgZXZlbnQucmV0dXJuVmFsdWUgPSBwYXRoLnJlc29sdmUoLi4uYXJncyk7XG4gIH0sXG4pO1xuXG5pcGNNYWluLm9uKGNoYW5uZWwucGF0aC5qb2luLCBhc3luYyAoZXZlbnQsIC4uLmFyZ3M6IFdpbmRvd0VsZWN0cm9uUGFyYW1ldGVyc1sncGF0aCddWydqb2luJ10pID0+IHtcbiAgZXZlbnQucmV0dXJuVmFsdWUgPSBwYXRoLmpvaW4oLi4uYXJncyk7XG59KTtcblxuaXBjTWFpbi5vbihjaGFubmVsLnBhdGguc2VwLCBhc3luYyBldmVudCA9PiB7XG4gIGV2ZW50LnJldHVyblZhbHVlID0gcGF0aC5zZXA7XG59KTtcblxuaXBjTWFpbi5vbihcbiAgY2hhbm5lbC5mcy5leGlzdHNTeW5jLFxuICBhc3luYyAoZXZlbnQsIC4uLmFyZ3M6IFdpbmRvd0VsZWN0cm9uUGFyYW1ldGVyc1snZnMnXVsnZXhpc3RzU3luYyddKSA9PiB7XG4gICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmcy5leGlzdHNTeW5jKC4uLmFyZ3MpO1xuICB9LFxuKTtcblxuaXBjTWFpbi5vbihcbiAgY2hhbm5lbC5mcy5yZW1vdmVTeW5jLFxuICBhc3luYyAoZXZlbnQsIC4uLmFyZ3M6IFdpbmRvd0VsZWN0cm9uUGFyYW1ldGVyc1snZnMnXVsncmVtb3ZlU3luYyddKSA9PiB7XG4gICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmcy5yZW1vdmVTeW5jKC4uLmFyZ3MpO1xuICB9LFxuKTtcblxuaXBjTWFpbi5vbihcbiAgY2hhbm5lbC5mcy5lbXB0eURpclN5bmMsXG4gIGFzeW5jIChldmVudCwgLi4uYXJnczogV2luZG93RWxlY3Ryb25QYXJhbWV0ZXJzWydmcyddWydlbXB0eURpclN5bmMnXSkgPT4ge1xuICAgIGV2ZW50LnJldHVyblZhbHVlID0gZnMuZW1wdHlEaXJTeW5jKC4uLmFyZ3MpO1xuICB9LFxuKTtcblxuLy8gbm9kZSBlbmRcblxuY29uc3Qgc3RvcmUgPSBuZXcgU3RvcmUoe1xuICBuYW1lOiAnZ2l0LWxvZy1leHRyYWN0LW1haW4tY29uZmlnJyxcbiAgY3dkOiBwYXRoLmpvaW4oYXBwLmdldFBhdGgoJ2FwcERhdGEnKSwgYXBwVGl0bGUpLFxufSk7XG5cbmlwY01haW4ub24oY2hhbm5lbC5zdG9yZS5zZXQsIGFzeW5jIChldmVudCwgLi4uYXJnczogV2luZG93RWxlY3Ryb25QYXJhbWV0ZXJzWydzdG9yZSddWydzZXQnXSkgPT4ge1xuICBzdG9yZS5zZXQoLi4uYXJncyk7XG59KTtcblxuaXBjTWFpbi5vbihjaGFubmVsLnN0b3JlLmdldCwgYXN5bmMgKGV2ZW50LCBrZXk6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogdW5rbm93bikgPT4ge1xuICBldmVudC5yZXR1cm5WYWx1ZSA9IHN0b3JlLmdldChrZXksIGRlZmF1bHRWYWx1ZSk7XG59KTtcblxuaXBjTWFpbi5oYW5kbGUoXG4gIGNoYW5uZWwuZ2l0LnJlcG9zaXRvcnlBdXRoVXJsLFxuICBhc3luYyAoZXZlbnQsIHVybDogc3RyaW5nLCB1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTCh1cmwpO1xuICAgIHVybE9iai51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgIHVybE9iai5wYXNzd29yZCA9IHBhc3N3b3JkO1xuICAgIHJldHVybiB1cmxPYmouaHJlZjtcbiAgfSxcbik7XG5cbmZ1bmN0aW9uIGNyZWF0ZUdpdChvcHRpb25zPzogUGFydGlhbDxTaW1wbGVHaXRPcHRpb25zPiwgb25Qcm9ncmVzcz86IChkYXRhOiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAndW5kZWZpbmVkJykge1xuICAgIG9wdGlvbnMgPSB7YmFzZURpcjogJyd9O1xuICB9XG4gIC8vIGlmIChvblByb2dyZXNzKSB7XG4gIC8vICAgb3B0aW9ucy5wcm9ncmVzcyAgPSAoZGF0YTogU2ltcGxlR2l0UHJvZ3Jlc3NFdmVudCkgPT4ge1xuICAvLyAgICAgY29uc29sZS5sb2coXG4gIC8vICAgICAgIGBnaXQuJHtkYXRhLm1ldGhvZH0gJHtkYXRhLnN0YWdlfSBzdGFnZSAke2RhdGEucHJvZ3Jlc3N9JSBjb21wbGV0ZWBcbiAgLy8gICAgICk7XG4gIC8vICAgICBvblByb2dyZXNzKGRhdGEpO1xuICAvLyAgIH07XG4gIC8vIH1cbiAgY29uc3QgZ2l0ID0gc2ltcGxlR2l0KG9wdGlvbnMpO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgZ2l0Lm91dHB1dEhhbmRsZXIoKGJpbiwgc3Rkb3V0LCBzdGRlcnIsIGFyZ3MpID0+IHtcbiAgICBzdGRvdXQucGlwZShwcm9jZXNzLnN0ZG91dCk7XG4gICAgc3RkZXJyLnBpcGUocHJvY2Vzcy5zdGRlcnIpO1xuICAgIHN0ZGVyci5vbignZGF0YScsIGZ1bmN0aW9uIChzdGREYXRhOiB7dG9TdHJpbmc6ICgpID0+IHN0cmluZ30pIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHN0ZERhdGEudG9TdHJpbmcoKSk7XG4gICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICBvblByb2dyZXNzKHN0ZERhdGEudG9TdHJpbmcoKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gZ2l0O1xufVxuXG5pcGNNYWluLmhhbmRsZShcbiAgY2hhbm5lbC5naXQuYnJhbmNoU3VtbWFyeSxcbiAgYXN5bmMgKGV2ZW50LCBkaXJlY3RvcnlQYXRoOiBzdHJpbmcsIHJlcG9zaXRvcnlBdXRoVXJsOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBnaXQgPSBjcmVhdGVHaXQoe1xuICAgICAgYmFzZURpcjogZGlyZWN0b3J5UGF0aCxcbiAgICB9KTtcbiAgICBhd2FpdCBnaXQuaW5pdCgpO1xuICAgIGF3YWl0IGdpdC5hZGRSZW1vdGUoJ29yaWdpbicsIHJlcG9zaXRvcnlBdXRoVXJsKTtcbiAgICBhd2FpdCBnaXQuZmV0Y2goWyctLXNoYWxsb3ctc2luY2U9XCIxIG1vbnRocyBhZ29cIiddKTtcbiAgICAvLyBhd2FpdCBnaXQucmVtb3RlKFtcInVwZGF0ZVwiXSk7XG4gICAgY29uc3QgYnJhbmNoU3VtbWFyeTogQnJhbmNoU3VtbWFyeSA9IGF3YWl0IGdpdC5icmFuY2goWyctciddKTtcbiAgICByZXR1cm4gYnJhbmNoU3VtbWFyeTtcbiAgfSxcbik7XG5cbmlwY01haW4uaGFuZGxlKFxuICBjaGFubmVsLmdpdC5sb2dSZXN1bHQsXG4gIGFzeW5jIChldmVudCwgZGlyZWN0b3J5UGF0aDogc3RyaW5nLCBsb2dPcHRpb25zOiBzdHJpbmdbXSkgPT4ge1xuICAgIGNvbnN0IGdpdCA9IGNyZWF0ZUdpdCh7YmFzZURpcjogZGlyZWN0b3J5UGF0aH0pO1xuICAgIGF3YWl0IGdpdC5mZXRjaChbJy0tc2hhbGxvdy1zaW5jZT1cIjEgbW9udGhzIGFnb1wiJ10pO1xuICAgIC8vIGNvbnNvbGUubG9nKCdnaXQgMScpO1xuICAgIC8vIGF3YWl0IGdpdC5yZW1vdGUoW1widXBkYXRlXCJdKTtcbiAgICAvLyAvLyBjb25zb2xlLmxvZygnZ2l0IDInKTtcbiAgICBjb25zdCBsb2dSZXN1bHQ6IExvZ1Jlc3VsdCA9IGF3YWl0IGdpdC5sb2cobG9nT3B0aW9ucyk7XG4gICAgLy8gY29uc29sZS5sb2coJ2dpdCAzJyk7XG4gICAgcmV0dXJuIGxvZ1Jlc3VsdDtcbiAgfSxcbik7XG4iLCJpbXBvcnQge3Jlc3RvcmVPckNyZWF0ZVdpbmRvd30gZnJvbSAnQC9tYWluL21haW5XaW5kb3cnO1xuaW1wb3J0IHthcHB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCAnLi9pcGNNYWluTGlzdGVuZXInO1xuLyoqXG4gKiBQcmV2ZW50IGVsZWN0cm9uIGZyb20gcnVubmluZyBtdWx0aXBsZSBpbnN0YW5jZXMuXG4gKi9cbmNvbnN0IGlzU2luZ2xlSW5zdGFuY2UgPSBhcHAucmVxdWVzdFNpbmdsZUluc3RhbmNlTG9jaygpO1xuaWYgKCFpc1NpbmdsZUluc3RhbmNlKSB7XG4gIGFwcC5xdWl0KCk7XG4gIHByb2Nlc3MuZXhpdCgwKTtcbn1cbmFwcC5vbignc2Vjb25kLWluc3RhbmNlJywgcmVzdG9yZU9yQ3JlYXRlV2luZG93KTtcblxuLyoqXG4gKiBEaXNhYmxlIEhhcmR3YXJlIEFjY2VsZXJhdGlvbiB0byBzYXZlIG1vcmUgc3lzdGVtIHJlc291cmNlcy5cbiAqL1xuYXBwLmRpc2FibGVIYXJkd2FyZUFjY2VsZXJhdGlvbigpO1xuXG4vKipcbiAqIFNob3V0IGRvd24gYmFja2dyb3VuZCBwcm9jZXNzIGlmIGFsbCB3aW5kb3dzIHdhcyBjbG9zZWRcbiAqL1xuYXBwLm9uKCd3aW5kb3ctYWxsLWNsb3NlZCcsICgpID0+IHtcbiAgaWYgKHByb2Nlc3MucGxhdGZvcm0gIT09ICdkYXJ3aW4nKSB7XG4gICAgYXBwLnF1aXQoKTtcbiAgfVxufSk7XG5cbi8qKlxuICogQHNlZSBodHRwczovL3d3dy5lbGVjdHJvbmpzLm9yZy9kb2NzL2xhdGVzdC9hcGkvYXBwI2V2ZW50LWFjdGl2YXRlLW1hY29zIEV2ZW50OiAnYWN0aXZhdGUnLlxuICovXG5hcHAub24oJ2FjdGl2YXRlJywgcmVzdG9yZU9yQ3JlYXRlV2luZG93KTtcblxuLyoqXG4gKiBDcmVhdGUgdGhlIGFwcGxpY2F0aW9uIHdpbmRvdyB3aGVuIHRoZSBiYWNrZ3JvdW5kIHByb2Nlc3MgaXMgcmVhZHkuXG4gKi9cbmFwcFxuICAud2hlblJlYWR5KClcbiAgLnRoZW4ocmVzdG9yZU9yQ3JlYXRlV2luZG93KVxuICAuY2F0Y2goZSA9PiBjb25zb2xlLmVycm9yKCdGYWlsZWQgY3JlYXRlIHdpbmRvdzonLCBlKSk7XG5cbi8qKlxuICogSW5zdGFsbCBWdWUuanMgb3IgYW55IG90aGVyIGV4dGVuc2lvbiBpbiBkZXZlbG9wbWVudCBtb2RlIG9ubHkuXG4gKiBOb3RlOiBZb3UgbXVzdCBpbnN0YWxsIGBlbGVjdHJvbi1kZXZ0b29scy1pbnN0YWxsZXJgIG1hbnVhbGx5XG4gKi9cbi8vIGlmIChpbXBvcnQubWV0YS5lbnYuREVWKSB7XG4vLyAgIGFwcC53aGVuUmVhZHkoKVxuLy8gICAgIC50aGVuKCgpID0+IGltcG9ydCgnZWxlY3Ryb24tZGV2dG9vbHMtaW5zdGFsbGVyJykpXG4vLyAgICAgLnRoZW4oKHtkZWZhdWx0OiBpbnN0YWxsRXh0ZW5zaW9uLCBWVUVKUzNfREVWVE9PTFN9KSA9PiBpbnN0YWxsRXh0ZW5zaW9uKFZVRUpTM19ERVZUT09MUywge1xuLy8gICAgICAgbG9hZEV4dGVuc2lvbk9wdGlvbnM6IHtcbi8vICAgICAgICAgYWxsb3dGaWxlQWNjZXNzOiB0cnVlLFxuLy8gICAgICAgfSxcbi8vICAgICB9KSlcbi8vICAgICAuY2F0Y2goZSA9PiBjb25zb2xlLmVycm9yKCdGYWlsZWQgaW5zdGFsbCBleHRlbnNpb246JywgZSkpO1xuLy8gfVxuXG4vKipcbiAqIENoZWNrIGZvciBuZXcgdmVyc2lvbiBvZiB0aGUgYXBwbGljYXRpb24gLSBwcm9kdWN0aW9uIG1vZGUgb25seS5cbiAqL1xuaWYgKGltcG9ydC5tZXRhLmVudi5QUk9EKSB7XG4gIGFwcFxuICAgIC53aGVuUmVhZHkoKVxuICAgIC50aGVuKCgpID0+IGltcG9ydCgnZWxlY3Ryb24tdXBkYXRlcicpKVxuICAgIC50aGVuKCh7YXV0b1VwZGF0ZXJ9KSA9PiBhdXRvVXBkYXRlci5jaGVja0ZvclVwZGF0ZXNBbmROb3RpZnkoKSlcbiAgICAuY2F0Y2goZSA9PiBjb25zb2xlLmVycm9yKCdGYWlsZWQgY2hlY2sgdXBkYXRlczonLCBlKSk7XG59XG4iXSwibmFtZXMiOlsiQnJvd3NlcldpbmRvdyIsImpvaW4iLCJhcHAiLCJpcGNNYWluIiwiZGlhbG9nIiwicGF0aCIsImZzIiwiU3RvcmUiLCJ1cmwiLCJVUkwiLCJzaW1wbGVHaXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUlBLGVBQWUsZUFBZTtBQUN0QixRQUFB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
